<html>
  <head>
    <title>Test ARIA</title>
    <style>
      /* for browsers that don't support hidden attribute */
      [hidden] {
        display: none;
      }
      
      /* make demo content easier to see */
      body, input, button {
        font-family: arial, sans-serif;
        font-size: 1em;
      }
      
      label {
        font-weight: bold;
      }

      /* cards */
      ul.cards {
        list-style: none;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(15rem, 1fr));
        grid-column-gap: 1.5rem;
        grid-row-gap: 1.5rem;
      }

      .cards li {
        border: 1px solid #999;
        display: flex;
        flex-direction: column;
        position: relative;
        padding: 1rem 1rem 0;
      }
      
      .cards li:hover,
      .cards li:focus-within {
        box-shadow: 0 0 0.25rem #CA261A;
      }

      a.button::after {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
      }

      a.button:hover, 
      a.button:focus {
        background: #CA261A;
      }

      .button {
        color: #fff;
        text-decoration: none;
        background-color: #0467C6;
        display: block;
        margin: 1rem 0 0 0;
        padding: 1rem;
        text-align: center;
      }

      .secondary {
        color: #0467C6;
        display: block;
        text-align: center;
        margin: 1rem 0 0;
        position: relative; /* raise the link about the a:after pseudo-content */
      }
     
      /* sliding nav menu */
      #quick-button {
        display: block;
        margin: 0.5rem 0 auto auto;
        position: relative;
      }
      
      #quick-links {
        background-color: #ebebeb;
        bottom: 0;
        max-width: 220px;
        overflow: auto;
        position: fixed;
        top: 0;
        right: -220px;
        width: 100%;
        z-index: 0;
        transition: all 300ms;
        -moz-transition: all 300ms;
        -o-transition: all 300ms;
        -webkit-transition: all 300ms;
      }
      
      #quick-links[aria-hidden="false"] {
        transform: translateX(-220px);
        -moz-transform: translateX(-220px);
        -ms-transform: translateX(-220px);
        -webkit-transform: translateX(-220px);
      }

      /* modal overlay */
      .modal-overlay {
        background:rgba(0,0,0,.8);
        height: 100%;
        width: 100%;
        top: 0;
        left: 0;
        display: flex;
        position: fixed;
        z-index: -1;
      }

      .modal-overlay[aria-hidden="true"] {
        opacity: 0;
        visibility: hidden;
      }

      .modal-overlay[aria-hidden="false"] {
        opacity: 1;
        visibility: visible;
        z-index: 2;
      }

      /* modal content area */
      .modal-content {
        background: #ebebeb;
        margin: auto;
        max-width: 400px;
        padding: 1.5em;
        position: relative;
      }

      /* close modal button */
      .btn-close {
        position: absolute;
        right: .25em;
        top: .25em;
      }
    </style>
  </head>
  
  <body>
    <div id="page">
    <h1>Test ARIA</h1>
      
    <hr>
    <!-- more details at 
    https://webaim.org/techniques/keyboard/tabindex
    -->
    <h2>Tabindex</h2>
    <a href="#heading">Jump to heading</a>
    <h3 id="heading" tabindex="-1">Heading with tabindex -1</h3>
    <h3 tabindex="0">Heading with tabindex 0</h3>

    <hr>
    <!-- adapted from
    https://www.w3.org/WAI/tutorials/forms/
    -->
    <h2>Keyboard support</h2>
      
    <form>
      <p>
        <label for="emailaddr">Email:</label>
        <input type="text" name="emailaddr" id="emailaddr" autocomplete="email">
      </p>

      <p>
        <input type="checkbox" name="subscribe" id="subscribe">
        <label for="subscribe">Subscribe to newsletter</label>
      </p>
      
      <p>
        <fieldset>
        <legend>Newsletter format</legend>
          <div>
            <input type="radio" name="format" id="txt" value="txt" checked>
            <label for="txt">Plain text</label>
          </div>
          <div>
            <input type="radio" name="format" id="web" value="web">
            <label for="web">Web page</label>
          </div>
        </fieldset>
      </p>
      
      <p>
        <fieldset>
        <legend>I want to receive</legend>
          <input type="checkbox" name="newsletter" id="check_1"> <label for="check_1">The weekly newsletter</label><br>
          <input type="checkbox" name="company_offers" id="check_2"> <label for="check_2">Offers from the company</label><br>
          <input type="checkbox" name="assoc_offers" id="check_3"> <label for="check_3">Offers from associated companies</label>
        </fieldset>
      </p>
      
      <p>
        <label for="frequency">Frequency</label><br>
        <select id="frequency">
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
        </select>
      </p>
      
      <input type="submit" value="Subscribe">
    </form>
      
    <hr>
    <!-- adapted from
    https://inclusive-components.design/cards/ and
    https://www.canadapost.ca/cpc/en/tools.page

    Very few modifications - minor simplification of design, content, CSS and HTML.
    -->
    <h2>Cards</h2>

    <ul class="cards">
      <li>
        <img src="https://canadapost.ca/cpc/assets/cpc/uploads/icons/mail-forwarding.svg" width="50" height="50" alt="">
        <h3 id="mail-forwarding">Mail Forwarding</h3>
        <p>Ensure all your important mail reaches you at your new address.<br>
          <a class="button" aria-describedby="mail-forwarding" href="https://sso.epost.ca/sso/lfe/ui/login?stepupId=smb_mode1,consumer,commercial_link,smb_link&templateId=cpcapps&manifestId=cpgSecurity&sourceUrl=https%3A%2F%2Fstg12.canadapost.ca%2Fweb%2Ffr%2Fpages%2Fepost%2Fdefault.page&targetUrl=https%3A//www.canadapost.ca/rso/en/mailforward&authlvl=&language=en">Use tool now</a>
          <a class="secondary" aria-describedby="mail-forwarding" href="https://www.canadapost.ca/cpc/en/personal/receiving/manage-mail/mail-forwarding.page?">Learn more</a>
        </p>
      </li>              
      <li>
        <img src="https://canadapost.ca/cpc/assets/cpc/uploads/icons/hold-mail.svg" width="50" height="50" alt="">
        <h3 id="hold-mail">Hold Mail</h3>
        <p>Keep your mail safe and secure when you're not there to receive it.<br>
          <a class="button" aria-describedby="hold-mail" href="https://canadapost.ca/rso/en/holdmail">Use tool now</a>
          <a class="secondary" aria-describedby="hold-mail" href="https://canadapost.ca/cpc/en/personal/receiving/manage-mail/hold-mail.page?" id="">Learn more</a>
        </p>
      </li>
      <li>
        <img src="https://canadapost.ca/cpc/assets/cpc/uploads/icons/flexdelivery.svg" width="50" height="50" alt="">
        <h3 id="flexdelivery">FlexDelivery</h3>
        <p>Have your online purchases delivered to any convenient post office.<br>
          <a class="button" aria-describedby="flexdelivery" href="https://www.epost.ca/dtpo/core/managePo.a?language=en&OWASP_CSRFTOKEN=">Use tool now</a>
          <a class="secondary" aria-describedby="flexdelivery" href="https://canadapost.ca/cpc/en/personal/receiving/alternative-delivery/flexdelivery.page?">Learn more</a>
        </p>
      </li>
    </ul> 

    <hr>
    <!-- adapted from
    https://codepen.io/marcysutton/pen/JoQqVw and
    https://knowbility.org/blog/2020/accessible-slide-menus/

    Modified to use JavaScript only, no jQuery and to simplify the code. I toggle aria-hidden on the container nav and change tabindex from -1 to 0 on links instead of toggling a hidden attribute because hidden elements can't use CSS transitions.
    -->
     
    <nav id="quick-links" aria-label="Quick links" aria-hidden="true">
      <ul>
        <li><a href="#" tabindex="-1">Blog</a></li>
        <li><a href="#" tabindex="-1">About</a></li>
        <li><a href="#" tabindex="-1">Contact</a></li>
      </ul>
    </nav>

    <h2>Sliding sidebar navigation</h2>
    <button type="button" id="quick-button" aria-expanded="false">
      Quick links
    </button>
     
    <script>
      
      var quickNav    = document.getElementById("quick-links"),
          quickButton = document.getElementById("quick-button"),
          quickLinks  = quickNav.querySelectorAll("a");
    
      // slide menu in or out on quick links button click
      quickButton.addEventListener("click", slideMenu);
      
      function slideMenu() {
        if (quickNav.getAttribute("aria-hidden") === "true") {
          showMenu();
        } else {
          hideMenu();
        }
      }

      function showMenu() {
        quickNav.setAttribute("aria-hidden", "false");
        quickButton.setAttribute("aria-expanded", "true");
        
        for (i = 0; i < quickLinks.length; i++) {
          quickLinks[i].removeAttribute("tabindex");
        }
        // move focus to first link in menu
        quickLinks[0].focus();
      }
      
      function hideMenu() {
        quickNav.setAttribute("aria-hidden", "true");
        quickButton.setAttribute("aria-expanded", "false");
        
        for (i = 0; i < quickLinks.length; i++) {
          quickLinks[i].setAttribute("tabindex", "-1");
        }
        // return focus to button used to open menu
        quickButton.focus();
      }
      
      /* There are multiple elements on this page that can be closed with the
      escape key. For simplicity, I've added a listener to each component, 
      but ideally, the escape key should work outside each specific 
      component. This would involve a global page listener that would close 
      any of the open components and reset the focus properly. */
      
      // allow navigation using arrow keys and close with escape key     
      quickNav.addEventListener("keydown", e => {
        
        if (e.keyCode === 38 || e.keyCode === 40) {
          // prevent page scroll on arrow up/down when menu is open
          e.preventDefault();
          
          // get the parent <li> of selected <a>
          var current = document.activeElement.parentElement;
          
          // move to next link on down arrow
          if (e.keyCode === 40) {
            if(current.nextElementSibling) {
              // focus on the child <a> of the next <li>
              current.nextElementSibling.firstChild.focus();
            } else {
              // if no next link, circle back to first link
              quickLinks[0].focus();
            }
          
          // move to previous link on up arrow
          } else if (e.keyCode === 38) {
            if(current.previousElementSibling) {
              // focus on the child <a> of the previous <li>
              current.previousElementSibling.firstChild.focus(); 
            } else {
              // if no previous link, circle around to last link
              quickLinks[quickLinks.length - 1].focus();
            }
          }
        }
        
        // close menu on escape key press
        if (e.keyCode === 27) {
          slideMenu();
        }
        
      });
    </script>
     
    <hr>
    <!-- adapted from 
    https://www.canadapost.ca/cpc/en/personal.page and https://www.smashingmagazine.com/2017/11/building-accessible-menu-systems/
    
    Modified Canada Post code to change top-level link to a button. Reduced the number of links and removed closing x to simplify example. See modal demo for how to create a closing x. Replaced the show/hide function with the hidden attribute and CSS which allowed me to remove tabindex="-1" and the associated toggling.
    -->
    <h2>Dropdown navigation</h2>
      
    <nav aria-label="Product navigation" id="product-nav">
      <ul>
        <li>
          <button type="button" aria-expanded="false" aria-controls="receiving">
            Receiving
          </button>
          
          <ul id="receiving" hidden>
            <li><h3><a role="menuitem" href="https://www.canadapost.ca/cpc/en/personal/receiving.page">Receiving overview</a></h3>
              <ul>
                <li><a href="https://www.canadapost.ca/cpc/en/personal/receiving/manage-mail.page">Manage your mail</a>
                  <ul>
                    <li><a href="https://www.canadapost.ca/cpc/en/personal/receiving/manage-mail/mail-forwarding.page">Forward your mail</a></li>
                    <li><a href="https://www.canadapost.ca/cpc/en/personal/receiving/manage-mail/hold-mail.page">Hold your mail</a></li>
                  </ul>
                </li>
                <li><a href="https://www.canadapost.ca/cpc/en/personal/receiving/alternative-delivery.page">Alternative delivery options</a>
                  <ul>
                    <li><a href="https://www.canadapost.ca/cpc/en/personal/receiving/alternative-delivery/flexdelivery.page">Deliver purchases to post office (FlexDelivery)</a></li>
                    <li><a href="https://www.canadapost.ca/cpc/en/personal/receiving/alternative-delivery/post-office-box.page">Rent a post office box</a></li>
                    <li><a href="https://www.canadapost.ca/cpc/en/personal/receiving/alternative-delivery/parcel-lockers.page">Parcel lockers</a></li>
                  </ul>
                </li>
                <li><a href="https://www.canadapost.ca/cpc/en/personal/receiving/moving-house.page">Moving to a new home</a></li>
                <li><a href="https://www.canadapost.ca/trackweb/en">Track a package</a></li>
              </ul>
            </li>
          </ul>
        </li>

        <li>
          <button type="button" aria-expanded="false" aria-controls="sending">
            Sending
          </button>
          
          <ul id="sending" hidden>
            <li>
              <h3><a href="https://www.canadapost.ca/cpc/en/personal/sending.page">Sending overview</a></h3>
                <ul>
                  <li><a href="https://www.canadapost.ca/cpc/en/personal/sending/letters-mail.page">Letters and mail</a>
                    <ul>
                      <li><a href="https://www.canadapost.ca/cpc/en/personal/sending/letters-mail/postage-rates.page">Postage rates</a></li>
                      <li><a href="https://www.canadapost.ca/cpc/en/personal/sending/letters-mail/letter-size.page">Letter weight and size</a></li>
                    </ul>
                  </li>
                  <li><a href="https://www.canadapost.ca/cpc/en/personal/sending/parcels.page">Parcels</a>
                    <ul>
                      <li><a href="https://www.canadapost.ca/cpc/en/personal/sending/parcels/ship-online.page">Ship online</a></li>
                      <li><a href="https://www.canadapost.ca/cpc/en/personal/sending/parcels/return-labels.page">Return your purchase</a></li>
                      <li><a href="https://www.canadapost.ca/cpotools/apps/wtz/business/landedCost">Estimate duties and taxes</a></li>
                      <li><a href="https://www.canadapost.ca/cpotools/apps/cdc">Complete customs form</a></li>
                    </ul>
                  </li>
                </ul>
            </li>
          </ul>
        </li>
      </ul>
    </nav>
      
    <script>
      var nav        = document.getElementById("product-nav"),
          navButtons = nav.getElementsByTagName("button"),
          menu       = nav.getElementsByTagName("ul"),
          menuLinks  = nav.getElementsByTagName("a"),
          lastFocus;
      
      for (i = 0; i < navButtons.length; i++) {
        navButtons[i].addEventListener("click", toggleDropdown);
      }
        
      // show/hide the dropdown menu
      function toggleDropdown() {
        
        var expanded = this.getAttribute("aria-expanded") === "true" || false;
        this.setAttribute("aria-expanded", !expanded);
        
        // toggle the hidden attribute on the ul under the menu button
        menu = this.nextElementSibling;
        menu.hidden = !menu.hidden;
        
        // remember button used to open menu
        lastFocus = document.activeElement;
        
        // if menu is open, set focus to first link
        if (this.getAttribute("aria-expanded")) {
          // in the ul under the menu button, get first <a> and set focus
          this.nextElementSibling.getElementsByTagName("a")[0].focus();
        }
        // if menu is closed return focus to button used to open the menu
        else {
          lastFocus.focus();
        }
      }

      /* There are multiple elements on this page that can be closed with the
      escape key. For simplicity, I've added a listener to each component, 
      but ideally, the escape key should work outside each the specific 
      component. This would involve a global page listener that would close 
      any of the open components and reset the focus properly. */
      
      // close all open menus on escape key press
      nav.addEventListener("keydown", function(e) {
        
        if (e.keyCode === 27) {
          for (i = 0; i < navButtons.length; i++) {
            navButtons[i].setAttribute("aria-expanded", "false");
            navButtons[i].nextElementSibling.hidden = "true";
          }

          // return focus to last button used to open a menu
          if (lastFocus) {
            lastFocus.focus();
          }
        }

      });
        
    </script>
      
    <hr>
    <!-- adapted from 
    https://www.w3.org/TR/wai-aria-practices/examples/accordion/accordion.html 
    
    Note that aria-expanded is on the accordion heading/button, 
    not the content panel. Putting it on the panel is a common error. 
    -->
    <h2>Accordion</h2>
    
    <div class="accordion">
      <h3>
        <button type="button" aria-expanded="false" aria-controls="fruit">
          Fruit
        </button>
      </h3>
      <div id="fruit" style="display: none">
        <ul>
          <li>Blueberries</li>
          <li>Strawberries</li>
          <li>Bananas</li>
        </ul>
      </div>

      <h3>
        <button type="button" aria-expanded="false" aria-controls="veg">
          Vegetables
        </button>
      </h3>
      
      <div id="veg" style="display: none">
        <ul>
          <li>Carrots</li>
          <li>Zucchini</li>
          <li>Potatoes</li>
        </ul>
      </div>
    </div>

    <script>
      var accordion = document.querySelectorAll(".accordion button");
      
      for (i = 0; i < accordion.length; i++) {
        accordion[i].addEventListener("click", showContent);
      }
      
      function showContent() {
        var target = event.target;
        
        // check if the clicked accordion button is expanded
        var isExpanded = target.getAttribute("aria-expanded") == "true";

        // show the accordion content
        if (!isExpanded) {
          target.setAttribute("aria-expanded", "true");
          target.setAttribute("style", "background: yellow");
          
          document.getElementById(
            target.getAttribute("aria-controls")
          ).style.display = "block";
        }
        
        // hide the accordion content
        else {
          target.setAttribute("aria-expanded", "false");
          target.removeAttribute("style");
          
          document.getElementById(
            target.getAttribute("aria-controls")
          ).style.display = "none";
        }
        
      }  
    </script>
    
    <hr>
    <!-- adapted from 
    https://www.deque.com/blog/a11y-support-series-part-1-aria-tab-panel-accessibility/

    Modified from WAI-ARIA recommendations to allow users to tab between tabs as some keyboard users would expect. In the ARIA specs, you should only be able to navigate by arrow keys. 

    I've also set the focus to the selected tab panel so that a screen reader goes right to selected tab's panel content. 

    Divs aren't normally focusable, but adding tabindex="-1" with JavaScript will move the focus to the panel content. 
    -->
    <h2>Tabs</h2>
 
    <div class="tabs">
      
      <div role="tablist">
        <button type="button" role="tab" aria-selected="true" 
            id="apples-tab" aria-controls="apples-panel" 
            style="background: yellow">
          Apples
        </button>
        <button type="button" role="tab" aria-selected="false" 
            id="bananas-tab" aria-controls="bananas-panel">
          Bananas
        </button>
        <button type="button" role="tab" aria-selected="false" 
            id="peaches-tab" aria-controls="peaches-panel">
          Peaches
        </button>
      </div>
      
      <div id="apples-panel" role="tabpanel" 
           aria-labelledby="apples-tab">
        <h3>Apples</h3>
        <p>Apples are amazing!</p>
        <a href="apple.html">How appealing</a>
      </div>
      <div id="bananas-panel" role="tabpanel" 
           aria-labelledby="bananas-tab" style="display: none">
        <h3>Bananas</h3>
        <p>Don't slip on your banana peel!</p>
        <a href="banana.html">Peel me</a>
      </div>
      <div id="peaches-panel" role="tabpanel" 
           aria-labelledby="peaches-tab" style="display: none">
        <h3>Peaches</h3>
        <p>Peaches keep peaching!</p>
        <a href="peach.html">Get peachy</a>
      </div>
      
    </div><!-- .tabs -->
    
    <script>
      var tabs = document.querySelectorAll("[role=tab]"),
          tabList = document.querySelector("[role=tablist]"),
          tabPanels = document.querySelectorAll("[role=tabpanel]"); 
      
      for (i = 0; i < tabs.length; i++) {
        tabs[i].addEventListener("click", showTabPanel);
      }
      
      function showTabPanel() { 
        var target = event.target;
        
        // close any open tabs and reset tab button
        for (i = 0; i < tabPanels.length; i++) {
            tabPanels[i].style.display = "none";
            tabPanels[i].removeAttribute("tabindex");
        }

        for (i = 0; i < tabs.length; i++) {
          tabs[i].setAttribute("aria-selected", "false");
          tabs[i].setAttribute("style", "background: default");
        }
        
        // find panel to open through the aria-controls of the clicked tab button
        var tabPanelToOpen = document.getElementById(
          target.getAttribute("aria-controls")
        );
        
        // open selected tab and set focus on content so user bypasses other tabs
        tabPanelToOpen.style.display = "block";
        tabPanelToOpen.setAttribute("tabindex", -1);
        tabPanelToOpen.focus();
        
        // highlight open tab button and update aria
        target.setAttribute("aria-selected", "true");
        target.setAttribute("style", "background: yellow");
      }
      
      // add ability to navigate tabs using arrow keys
      tabList.addEventListener("keydown", e => {
        
        if (e.keyCode === 39 || e.keyCode === 37) {
          var selected = document.activeElement;
          
          // move right on right arrow
          if (e.keyCode === 39) {
            if (selected.nextElementSibling) {
              selected.nextElementSibling.click();
              selected.nextElementSibling.focus();
            }
            
          // move left on left arrow
          } else if (e.keyCode === 37) {
            if (selected.previousElementSibling) {
              selected.previousElementSibling.click();
              selected.previousElementSibling.focus();
            }
          }
          
        }
        
      });
    </script>
      
    <hr>
    <!-- adapted from
    https://developer.paciellogroup.com/blog/2016/01/simple-inline-error-message-pattern/
    https://www.w3.org/WAI/tutorials/forms/notifications/
    https://www.w3.org/WAI/WCAG21/Techniques/aria/ARIA19

    Notifications should be close enough to the user's focus so someone using magnification will notice them. If not, move the focus with JavaScript.

    If a form has multiple errors, it's helpful to notify the user how many errors there are, but it's not required for accessibility compliance.

    It's best practice to set the focus on the first error, to help users fix errors faster.
    -->
    <h2>Notifications</h2>
    <div id="status" role="status" aria-live="polite"></div>
      
    <p>
      <label for="name">Name</label> 
      <br><span id="hint-name">First and last</span>
      <br><input type="text" id="name" 
        autocomplete="name" 
        aria-required="true"
        aria-describedby="hint-name error-name">
      <span id="error-name"></span>
    </p>
      
    <p>
      <label for="email">Email</label> 
      <span id="hint-email">(optional)</span>
      <br><input type="text" id="email" 
        autocomplete="email"
        aria-describedby="hint-email">
      <span id="error-email"></span>
    </p>
      
    <p>
      <label id="label1" for="phone">Phone</label>
      <br><span id="hint-phone">Format: 999-999-9999</span>
      <br><input type="text" id="phone" 
        autocomplete="phone" 
        aria-required="true"
        aria-describedby="hint-phone error-phone">
      <span id="error-phone"></span>
    </p>
 
    <p>
      <button type="submit" id="form-submit">submit</button> 
      <button type="button" id="form-cancel">cancel</button>
    </p>
      
    <div id="alert" role="alert"></div>
    
    <script>
      
      var formSubmit = document.getElementById("form-submit"),
          formCancel = document.getElementById("form-cancel"),
          status = document.getElementById("status"),
          errName = document.getElementById("error-name"),
          errPhone = document.getElementById("error-phone"),
          name = document.getElementById("name"),
          phone = document.getElementById("phone");
      
      formSubmit.addEventListener("click", showError, false);
      formCancel.addEventListener("click", showAlert);
      
      // show two errors on the page (this function demos error messaging only - it doesn't actually check for errors)
      function showError() {
        status.innerHTML = "There are two errors on this page. Please fix them and resubmit the form.";
        errName.innerHTML = "&nbsp;<strong>Error</strong>: Name is required";
        errPhone.innerHTML = "&nbsp;<strong>Error</strong>: Phone is required";
        name.setAttribute("aria-invalid", "true");
        phone.setAttribute("aria-invalid", "true");
        name.focus();
      }
      
      // show alert (this demos the alert role - it doesn't have any other cancellation functionality like clearing form fields)
      function showAlert() {
        var alert = document.getElementById("alert");
        alert.innerHTML = "Your form submission was cancelled."; 
      }
    </script>
    
    <hr>
    <!-- adapted from 
    https://www.smashingmagazine.com/2014/09/making-modal-windows-better-for-everyone/

    Demo links:
    https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/6793fff0-3ca1-4c05-b383-81aa8c9163e8/accessible.html
    https://codepen.io/scottohara/pen/lIdfv

    Styles included in the <head> because you can't demo a modal without styles.
    You need to move focus into the modal when it opens and keep it there until it is closed.
    -->
    <h2>Modal dialog</h2>

    <p>
      <button type="button" id="modal-open">Sign in modal</button>
    </p>
    <p>
      <button onclick="openDialog()">Regular dialog</button>
    </p>

    </div><!-- #page -->
    
   <div class="modal-overlay" id="modal-window" aria-modal="true"
      aria-hidden="true" role="dialog" aria-labelledby="modal_title">

      <div class="modal-content" id="modal-holder" role="document">

          <h3 id="modal_title">Access your account</h3>
          <form>
            <p>
              <label for="user">Username:</label>
              <input type="text" id="user" />
            </p>
            <p>
              <label for="pass">Password:</label>
              <input type="text" id="pass" />
            </p>
            <button type="submit">Sign in</button>
          </form>

        <button type="button" class="btn-close" id="modal-close" aria-label="close">
          &times;
        </button>

      </div><!-- .modal-content -->

    </div><!-- .modal-overlay -->
    
    <script>
      
      // place modal window as the first child of the #page div
      var m = document.getElementById("modal-window"),
          p = document.getElementById("page");
      p.parentNode.insertBefore(m, p);

      var mOverlay = document.getElementById("modal-window"),
          mOpen    = document.getElementById("modal-open"),
          mClose   = document.getElementById("modal-close"),
          modal    = document.getElementById("modal-holder"),
          firstField = document.getElementById("user"),
          allNodes   = document.querySelectorAll("*"),
          modalOpen  = false,
          lastFocus;

      mOpen.addEventListener("click", modalShow); // sign in button click
      mClose.addEventListener("click", modalClose); // modal close button click
      document.addEventListener("keydown", modalClose); // escape key press
      
      // open the modal
      function modalShow(focusItem) {
        lastFocus = document.activeElement; // save button used to open modal
        mOverlay.setAttribute("aria-hidden", "false");
        modalOpen = true;
        firstField.focus(); // set focus on the first field in the modal    
      }

      // restrict focus to the modal window when it's open
      for (i = 0; i < allNodes.length; i++) {
        allNodes.item(i).addEventListener("focus", focusRestrict);
      }

      function focusRestrict(e) {
        if (modalOpen && !modal.contains(e.target)) {
          e.stopPropagation();
          firstField.focus();
        }
      }
      
      // button click or escape key closes the modal
      function modalClose(e) {
        if (modalOpen && (!e.keyCode || e.keyCode === 27) ) {
          mOverlay.setAttribute("aria-hidden", "true");
          modalOpen = false;
          lastFocus.focus(); // return focus to button used to open modal
        }
      }
      
      // clicking on the overlay closes the modal
      mOverlay.addEventListener("click", function(e) {
        if (e.target == modal.parentNode) {
           modalClose(e);
         }
      }, false);

    </script>
    
    <script>
    // non-modal dialog for comparison
    function openDialog() {
      var person = prompt("Please enter your name:");
    }
    </script>

  </body>
</html>
